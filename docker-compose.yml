version: "3"
services:
  gamecon:
    build: .
    volumes:
      - .:/var/www/html:delegated
    command: sh -c "sudo -u www-data composer install &&
      chgrp -R www-data /var/www/html/cache &&
      chmod -R g+rw /var/www/html/cache &&
      apache2-foreground"
    labels:
      - "traefik.frontend.rule=Host:gamecon.loc"
      - "traefik.docker.network=docker-www"
      - "traefik.docker.port=80"
    networks:
      - default
      - proxy

  sql.gamecon:
    image: mariadb:10.1
    environment:
      - MYSQL_ROOT_PASSWORD=root
    labels:
      - "traefik.backend=sql.gamecon"
      - "traefik.frontend.rule=Host:sql.gamecon.loc"
      - "traefik.docker.network=docker-www"
    ports:
      - 13306:3306
    networks:
      - default
      - proxy

networks:
  proxy:
    external:
      name: docker-www
